<div class="reviews">
  <% @reviews.each do |review| %>      
    <div class="review <%= 'downvoted' if review.votes <= -2 %>">
      <table>
        <tr class="rev-title">
          <td colspan="2">
            <h4><%= review.title %></h4>
            <em>author: <%= review.user.username %> | posted: <%= time_ago_in_words(review.created_at) %> ago.</em>
          </td>     
        </tr>
        <tr class="rev-content">
          <td class="content"><%= review.content %></td>
          <td>
            <span class="pull-right">
              <%= pluralize(review.votes, 'vote') %>
              <% if current_user && current_user.can_vote_for_review?(review) %>
                <%= link_to 'up', vote_review_path(review, value: 1), method: "post" %>
                <%= link_to 'down', vote_review_path(review, value: -1), method: "post" %>
              <% end %>
              |
              <%= link_to 'Comment', 'javascript:void(0)', class: "toggle-new-comment" %>
            </span>
          </td>
        </tr>
      </table>
    </div>
    <div class="comments">
      
      <%= render partial: "comments/comment", collection: @comments.where(review_id: review.id) %>   
      
      <div class="toggle-comments">
        <% if review.comments.count > 1 %>
          <%= link_to'javascript:void(0)' do  %>
            <span>Show more comments</span>
            <span>(<%= review.comments.count %>)</span> 
            <span class="caret"></span>
            <span>Hide comments<span class="caret caret-reversed"></span></span>
          <% end %>
        <% end %>
      </div>    

      <div class="new-comment">
        <%= form_for @comment do |f| %>
          <%= f.hidden_field :review_id, value: review.id %>
          <%= f.text_field :content, class: "form-control" %>
          <%= f.submit 'Save', class: "btn btn-primary" %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
